<%= turbo_stream_from current_user, :transactions %>

<div class="p-4 space-y-4">
  <div class="card bg-primary/10 border border-primary/20">
    <div class="card-body">
      <h2 class="card-title text-primary">Add New Transaction</h2>
      <div data-controller="form-reset">
        <%= form_with model: @new_transaction, data: { action: "turbo:submit-end->form-reset#clear" }, class: "space-y-4" do |f| %>
          <div class="form-control">
            <%= f.text_field :raw_input, 
                placeholder: "e.g. spent 2 euros for coffee", 
                class: "input input-bordered w-full" %>
          </div>
          <%= f.submit "Add Transaction", class: "btn btn-primary w-full" %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="card bg-base-200 border border-base-300">
    <div class="card-body">
      <h2 class="card-title text-base-content">Cashflow Overview</h2>
      
      <div class="mt-4">
        <div class="flex items-baseline gap-2 mb-6">
          <span class="text-3xl font-bold <%= @total_cashflow >= 0 ? 'text-success' : 'text-error' %>">
            <%= number_to_currency(@total_cashflow, unit: "€") %>
          </span>
          <span class="text-sm text-base-content/60">Total Cashflow</span>
        </div>

        <% if @monthly_cashflow.any? %>
          <% max_amount = @monthly_cashflow.values.map(&:abs).max %>
          <div class="space-y-3">
            <% @monthly_cashflow.each do |month, amount| %>
              <div class="flex items-center gap-3">
                <div class="w-20 text-xs text-base-content/70 flex-shrink-0">
                  <%= month.strftime("%b %Y") %>
                </div>
                <div class="flex-1 relative h-8 bg-base-300 rounded overflow-hidden">
                  <div 
                    class="h-full <%= amount >= 0 ? 'bg-success' : 'bg-error' %> rounded transition-all duration-500"
                    style="width: <%= max_amount > 0 ? (amount.abs / max_amount * 100) : 0 %>%"
                  ></div>
                </div>
                <div class="w-24 text-right flex-shrink-0">
                  <span class="text-xs font-semibold <%= amount >= 0 ? 'text-success' : 'text-error' %>">
                    <%= number_to_currency(amount, unit: "€") %>
                  </span>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-sm text-base-content/60 italic">No transactions yet</p>
        <% end %>
      </div>
    </div>
  </div>

  <div id="transactions_list" class="flex flex-col gap-2">
    <%= render @transactions %>
  </div>
</div>