<!DOCTYPE html>
<html lang="en">
  <head>
    <title><%= content_for(:title) || "Moneyfast" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Moneyfast">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# PWA Manifest %>
    <%= tag.link rel: "manifest", href: pwa_manifest_path %>

    <%# Favicons %>
    <%= favicon_link_tag "favicon.ico", rel: "icon", type: "image/x-icon" %>
    <%= favicon_link_tag "icon.svg", rel: "icon", type: "image/svg+xml" %>
    <%= favicon_link_tag "icon.png", rel: "icon", type: "image/png" %>

    <%# Apple Touch Icons for iOS Safari PWA %>
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/icon.png">

    <%# Bootstrap CSS %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <%# Bootstrap Icons %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <%# Bootstrap JS Bundle %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </head>

  <body class="bg-light">
    <div class="turbo-progress-bar"></div>
    
    <div class="container-fluid px-0">
      <div class="row justify-content-center">
        <div class="col-12 col-md-6 col-lg-5 col-xl-4">
          <div class="d-flex flex-column min-vh-100 bg-white shadow-sm">
            <%# Navbar %>
            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
              <div class="container-fluid px-3">
                <a class="navbar-brand fw-bold" href="/">MoneyFast</a>
                <div class="d-flex align-items-center">
                  <% if user_signed_in? %>
                    <%= link_to stats_path, class: "btn btn-link text-decoration-none", title: "Statistics" do %>
                      <i class="bi bi-bar-chart fs-5"></i>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </nav>

            <%# Flash Messages %>
            <% if flash.any? %>
              <div data-controller="flash" class="position-fixed bottom-0 start-0 end-0 d-flex flex-column align-items-center gap-2 p-3" style="z-index: 1050; pointer-events: none;">
                <% flash.each do |type, message| %>
                  <div 
                    class="alert alert-<%= type == 'notice' ? 'success' : type == 'alert' ? 'danger' : 'info' %> alert-dismissible fade show mb-0 w-100" 
                    style="max-width: 500px; transform: translateY(100%); transition: transform 0.3s ease-in-out; pointer-events: auto;"
                    data-flash-target="message"
                    data-flash-type="<%= type %>"
                    role="alert"
                  >
                    <span><%= message %></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                <% end %>
              </div>
            <% end %>

            <%# Main Content %>
            <main class="flex-grow-1">
              <%= yield %>
            </main>

            <%# Footer %>
            <% if user_signed_in? %>
              <footer class="mt-auto py-4">
                <p class="text-center text-muted small mb-0">
                  <%= link_to("Sign Out", destroy_user_session_path, method: :delete, data: { turbo_method: :delete }, class: "text-danger text-decoration-none") %>
                </p>
              </footer>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
